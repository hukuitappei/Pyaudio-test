# 🎤 音声録音＆文字起こしアプリ（設定機能付き統合版）

Streamlitを使用した高機能な音声録音・文字起こしアプリケーションです。設定ページ、エラーハンドリング機能、システム診断機能を備えた統合版です。

## 🚀 主な機能

### 🎤 録音・文字起こしタブ
- **マイクデバイス選択**: 利用可能なマイクデバイスから選択
- **レベル監視**: 選択されたマイクの音声レベルをリアルタイム表示
- **音声ゲイン機能**: 録音時に音声レベルを自動で上げる（1.0x〜5.0x）
- **音声品質分析**: 録音後のRMS、最大振幅、無音比率を分析
- **高精度文字起こし**: ノイズ除去、音量正規化、最適化されたパラメータ
- **複数モデル比較**: 異なるモデルサイズでの結果を比較
- **ファイルアップロード**: 既存の音声ファイルも文字起こし可能

### ⚙️ 設定ページ
- **🎤 録音設定**: チャンクサイズ、サンプルレート、チャンネル数、録音時間、ゲイン
- **🤖 Whisper設定**: モデルサイズ、言語、温度、高精度パラメータ
- **🔧 デバイス設定**: マイクデバイス選択、アクセステスト、自動設定
- **🎨 UI設定**: 表示オプション、ファイル保存設定
- **🔧 トラブルシューティング設定**: リトライ回数、タイムアウト、エラー回復
- **🔍 システム診断**: システム情報、権限確認、デバイス診断、推奨設定

### 🔍 マイク情報タブ
- **システム情報**: Python、PyAudio、OS情報の表示
- **デフォルトデバイス**: システムのデフォルト入出力デバイス表示
- **全オーディオデバイス**: すべてのオーディオデバイスの詳細情報
- **マイクデバイス一覧**: マイクデバイスのみの一覧表示
- **アクセステスト**: 各デバイスが使用可能かテスト
- **トラブルシューティング**: 問題解決のヒントと解決方法

### 📁 ファイル管理タブ
- **保存ファイル一覧**: 録音されたファイルの詳細表示
- **ファイル品質分析**: 既存ファイルの音声品質を分析
- **ファイル文字起こし**: 保存されたファイルの文字起こし

## 🛠️ インストール

### 必要な環境
- Python 3.8以上
- Windows 10/11（推奨）

### 依存関係のインストール
```bash
pip install streamlit pyaudio whisper numpy scipy librosa
```

### アプリケーション起動
```bash
streamlit run app.py
```

## 🎯 使用方法

### 1. 設定ページでの初期設定
1. **設定ページ**に移動
2. **🎤 録音設定**でチャンクサイズ、サンプルレート、ゲインを調整
3. **🤖 Whisper設定**でモデルサイズと精度パラメータを設定
4. **🔧 デバイス設定**でマイクデバイスを選択し、アクセステストを実行
5. **🔍 システム診断**でシステムの状態を確認
6. **💾 設定を保存**で設定を保存

### 2. 録音・文字起こし
1. **🎤 録音・文字起こしタブ**に移動
2. マイクデバイスを選択
3. レベル監視で音声レベルを確認
4. 録音設定を調整（時間、ゲイン）
5. 録音実行
6. 音声品質分析で結果を確認
7. 通常精度または高精度で文字起こし

### 3. エラー対処
- **Errno -9999エラー**: 設定ページのシステム診断で解決策を確認
- **音声レベルが低い**: ゲイン設定を上げる、マイクに近づく
- **デバイスが認識されない**: 設定ページでデバイステストを実行

## 🔧 エラーハンドリング機能

### 対応エラー
- **Errno -9999**: ホストエラー（デバイス使用中、権限不足）
- **Errno -9998**: ストリームエラー（デバイス利用不可）
- **Errno -9997**: デバイスエラー（デバイス不存在）
- **Errno -9996**: バッファエラー（バッファサイズ不適切）
- **Errno -9995**: バッファオーバーフロー（データ処理遅延）
- **Errno -9994**: バッファアンダーフロー（データ不足）

### 自動解決機能
- **リトライ機能**: エラー時の自動リトライ
- **設定調整**: エラーに応じた設定の自動調整
- **診断機能**: システム状態の自動診断
- **解決策提案**: エラーに応じた具体的な解決策の提示

## ⚙️ 設定項目詳細

### 録音設定
- **チャンクサイズ**: 512, 1024, 2048, 4096（推奨: 1024以上）
- **サンプルレート**: 8000, 16000, 22050, 44100, 48000 Hz（推奨: 44100以下）
- **チャンネル数**: 1（モノラル）、2（ステレオ）
- **録音時間**: 1〜60秒
- **音声ゲイン**: 1.0x〜5.0x

### Whisper設定
- **モデルサイズ**: tiny, base, small, medium, large
- **言語**: ja（日本語）, en（英語）, auto（自動）
- **温度**: 0.0（決定論的）〜1.0（ランダム）
- **高精度パラメータ**: 圧縮比閾値、対数確率閾値、無音閾値

### トラブルシューティング設定
- **リトライ回数**: 1〜10回（推奨: 3回以上）
- **タイムアウト**: 5〜30秒
- **エラー回復**: 有効/無効
- **エラーログ**: 有効/無効

## 📁 ファイル構成

```
streamlit-pyaudio-voice-record/
├── app.py                    # メインアプリケーション
├── pages/
│   └── 1_設定.py            # 設定ページ
├── utils/
│   ├── error_handler.py      # エラーハンドリング機能
│   └── transcribe_utils.py   # 文字起こしユーティリティ
├── settings/
│   └── app_settings.json     # 設定ファイル
├── recordings/               # 録音ファイル保存先
└── README.md                 # このファイル
```

## 🔍 トラブルシューティング

### よくある問題と解決方法

#### Errno -9999 ホストエラー
**原因**: 他のアプリがマイクを使用中、権限不足
**解決方法**:
1. 他のアプリ（ブラウザ、Zoom、Teams等）を終了
2. Windows設定 → プライバシーとセキュリティ → マイクでアクセス許可
3. デバイスドライバーを更新
4. 仮想オーディオデバイスを一時的に無効化
5. アプリを管理者として実行
6. チャンクサイズを大きくする（2048, 4096）
7. サンプルレートを下げる（22050, 16000）

#### 音声レベルが低い
**解決方法**:
1. ゲイン設定を上げる
2. マイクに近づく
3. Windows設定でマイク音量を確認
4. マイクブーストを有効にする

#### デバイスが認識されない
**解決方法**:
1. デバイスマネージャーでマイクが有効か確認
2. デバイスドライバーを再インストール
3. デバイスを再接続
4. アプリを再起動

#### 文字起こしが空になる
**解決方法**:
1. 音声レベルを確認
2. より明確に話す
3. 静かな環境で録音
4. 高精度設定を使用

## 🎯 精度向上のポイント

### 音声品質
- **静かな環境**: 背景ノイズを最小限に
- **クリアな発音**: はっきりと話す
- **適切な距離**: マイクから20-30cm程度
- **音声レベル**: RMS 100以上を目標

### 設定最適化
- **チャンクサイズ**: 1024以上で安定性向上
- **サンプルレート**: 44100Hz以下で互換性向上
- **ゲイン**: 音声レベルに応じて調整（1.5x〜3.0x推奨）
- **モデルサイズ**: 精度と速度のバランス（base推奨）

### 高精度設定
- **ノイズ除去**: 自動でノイズを除去
- **音量正規化**: 音声レベルを最適化
- **初期プロンプト**: 言語や内容のヒントを提供
- **複数モデル比較**: 最適な結果を選択

## 📝 更新履歴

### v2.0.0 (設定機能付き統合版)
- ✅ 設定ページの追加
- ✅ エラーハンドリング機能の強化
- ✅ システム診断機能の追加
- ✅ 設定の保存・読み込み機能
- ✅ 設定のエクスポート・インポート機能
- ✅ 詳細なトラブルシューティング情報
- ✅ 推奨設定の自動提案

### v1.0.0 (基本版)
- ✅ マイクデバイス選択機能
- ✅ 音声ゲイン機能
- ✅ レベル監視機能
- ✅ 高精度文字起こし
- ✅ 複数モデル比較
- ✅ ファイル管理機能

## 🤝 貢献

バグ報告や機能要望は、GitHubのIssuesでお知らせください。

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

---

**注意事項:**
- 初回起動時はWhisperモデルのダウンロードに時間がかかります
- 高精度設定は処理時間が長くなります
- マイクへのアクセス許可が必要です
- Windows環境での動作を最適化しています
