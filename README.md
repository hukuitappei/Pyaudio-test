# 🎤 音声録音＆文字起こしアプリ（統合版）

Streamlitを使用した高機能な音声録音・文字起こしアプリケーションです。設定機能、エラーハンドリング、音声修正、ユーザー辞書、コマンド管理、ショートカットキー機能を備えた完全統合版です。

## 🚀 主な機能

### 🎤 録音・文字起こし機能
- **マイクデバイス選択**: 利用可能なマイクデバイスから選択
- **レベル監視**: 選択されたマイクの音声レベルをリアルタイム表示
- **音声ゲイン機能**: 録音時に音声レベルを自動で上げる（1.0x〜5.0x）
- **音声品質分析**: 録音後のRMS、最大振幅、無音比率を分析
- **高精度文字起こし**: ノイズ除去、音量正規化、最適化されたパラメータ
- **複数モデル比較**: 異なるモデルサイズでの結果を比較
- **ファイルアップロード**: 既存の音声ファイルも文字起こし可能

### 🎙️ 音声修正機能
- **音声コマンドによる文字起こし結果の修正**
- **手動コマンド入力による修正**
- **リアルタイム音声認識とコマンド解析**

#### 利用可能な音声コマンド
- **修正**: 「修正 こんにちはをこんばんはに」→ テキスト内の「こんにちは」を「こんばんは」に修正
- **削除**: 「削除 不要な部分」→ テキスト内の「不要な部分」を削除
- **追加**: 「追加 新しい内容」→ テキストに「新しい内容」を追加
- **要約**: 「要約」→ テキストを要約
- **箇条書き**: 「箇条書き」→ テキストを箇条書きに変換

### 📚 ユーザー辞書機能
- **カテゴリ別の用語管理**
- **検索機能**
- **インポート・エクスポート機能**
- **統計情報表示**

#### デフォルトカテゴリ
- **技術用語**: 技術関連の用語
- **略語**: 略語とその意味
- **カスタム**: ユーザー定義の用語

### ⚙️ コマンド管理機能
- **LLM指示コマンドの管理**
- **コマンド実行と結果保存**
- **ファイル出力機能**

#### デフォルトコマンド
- **箇条書き**: 文字起こし結果を箇条書きに変換
- **要約**: 文字起こし結果を要約
- **テキストファイル出力**: 文字起こし結果をテキストファイルとして保存
- **LLM要約ファイル出力**: LLM要約結果をテキストファイルとして保存
- **キーポイント抽出**: 重要なポイントを抽出
- **アクションアイテム抽出**: アクションアイテムを抽出

### ⌨️ ショートカットキー機能
- **キーボードショートカットによる効率的な操作**
- **カスタマイズ可能なキー設定**
- **視覚的フィードバック**

#### デフォルトショートカットキー
| 機能 | ショートカット | 説明 |
|------|----------------|------|
| 録音開始 | **F9** | 選択されたマイクで録音を開始 |
| 録音停止 | **F10** | 録音を停止 |
| 文字起こし | **F11** | 録音データを文字起こし |
| テキストクリア | **F12** | 文字起こし結果をクリア |
| 録音保存 | **Ctrl+S** | 録音ファイルを保存 |
| 設定を開く | **Ctrl+,** | 設定ページを開く |
| 辞書を開く | **Ctrl+D** | ユーザー辞書ページを開く |
| コマンドを開く | **Ctrl+Shift+C** | コマンド管理ページを開く |
| 音声修正 | **Ctrl+V** | 音声修正タブに移動 |
| ヘルプ表示 | **F1** | ショートカットキー一覧を表示 |

### ⚙️ 設定機能
- **🎤 録音設定**: チャンクサイズ、サンプルレート、チャンネル数、録音時間、ゲイン
- **🤖 Whisper設定**: モデルサイズ、言語、温度、高精度パラメータ
- **🔧 デバイス設定**: マイクデバイス選択、アクセステスト、自動設定
- **🎨 UI設定**: 表示オプション、ファイル保存設定
- **🔧 トラブルシューティング設定**: リトライ回数、タイムアウト、エラー回復
- **🔍 システム診断**: システム情報、権限確認、デバイス診断、推奨設定
- **⌨️ ショートカット設定**: キーボードショートカットのカスタマイズ

## 🛠️ インストール

### 必要な環境
- Python 3.8以上
- Windows 10/11（推奨）

### 依存関係のインストール
```bash
pip install -r requirements.txt
```

### アプリケーション起動
```bash
cd streamlit-pyaudio-voice-record
streamlit run app.py
```

## 🎯 使用方法

### 1. 設定ページでの初期設定
1. **設定ページ**に移動
2. **🎤 録音設定**でチャンクサイズ、サンプルレート、ゲインを調整
3. **🤖 Whisper設定**でモデルサイズと精度パラメータを設定
4. **🔧 デバイス設定**でマイクデバイスを選択し、アクセステストを実行
5. **⌨️ ショートカット設定**でキーボードショートカットをカスタマイズ
6. **🔍 システム診断**でシステムの状態を確認
7. **💾 設定を保存**で設定を保存

### 2. 基本的な録音・文字起こしワークフロー
1. **🎤 録音**タブに移動
2. マイクデバイスを選択
3. **F9** で録音開始（またはボタンクリック）
4. 話す
5. **F10** で録音停止（またはボタンクリック）
6. **F11** で文字起こし実行（またはボタンクリック）
7. 音声品質分析で結果を確認

### 3. 音声修正機能の使用
1. **🎙️ 音声修正**タブに移動
2. 文字起こし結果を確認
3. 「🎤 音声コマンドを聞き取る」ボタンで音声コマンドを入力
4. 「🔍 コマンドを解析・実行」ボタンでコマンドを実行
5. または手動でコマンドを入力して実行

### 4. ユーザー辞書の使用
1. **📚 ユーザー辞書**タブで概要を確認
2. 「📖 辞書管理ページを開く」ボタンで詳細管理ページに移動
3. カテゴリ別にエントリを追加・編集・削除
4. 検索機能でエントリを検索

### 5. コマンド機能の使用
1. **⚙️ コマンド管理**ボタンでコマンド管理ページに移動
2. 文字起こし結果または直接テキスト入力からコマンドを実行
3. 結果をファイルとして保存・ダウンロード

## 📁 ファイル構成

```
streamlit-pyaudio-voice-record/
├── app.py                          # メインアプリケーション（4つのタブ構成）
├── pages/
│   ├── 1_設定.py                   # 設定ページ（7つのタブ構成）
│   ├── user_dictionary.py          # ユーザー辞書管理ページ
│   └── commands.py                 # コマンド管理ページ
├── utils/
│   ├── error_handler.py            # エラーハンドリング機能
│   ├── transcribe_utils.py         # 文字起こしユーティリティ
│   ├── voice_commands.py           # 音声コマンド処理クラス
│   ├── user_dictionary.py          # ユーザー辞書管理クラス
│   ├── command_processor.py        # コマンド処理クラス
│   └── shortcut_handler.py         # ショートカットキー処理クラス
├── settings/
│   ├── app_settings.json           # メイン設定ファイル
│   ├── user_dictionary.json        # ユーザー辞書データ
│   └── commands.json               # コマンド設定データ
├── recordings/                     # 録音ファイル保存先
├── outputs/                        # コマンド実行結果保存ディレクトリ
├── requirements.txt                # 依存関係
├── README.md                       # このファイル
├── 新機能追加_README.md            # 新機能詳細（参考）
└── ショートカットキー機能_README.md # ショートカット詳細（参考）
```

## 🔧 エラーハンドリング機能

### 対応エラー
- **Errno -9999**: ホストエラー（デバイス使用中、権限不足）
- **Errno -9998**: ストリームエラー（デバイス利用不可）
- **Errno -9997**: デバイスエラー（デバイス不存在）
- **Errno -9996**: バッファエラー（バッファサイズ不適切）
- **Errno -9995**: バッファオーバーフロー（データ処理遅延）
- **Errno -9994**: バッファアンダーフロー（データ不足）

### 自動解決機能
- **リトライ機能**: エラー時の自動リトライ
- **設定調整**: エラーに応じた設定の自動調整
- **診断機能**: システム状態の自動診断
- **解決策提案**: エラーに応じた具体的な解決策の提示

## ⚙️ 設定項目詳細

### 録音設定
- **チャンクサイズ**: 512, 1024, 2048, 4096（推奨: 1024以上）
- **サンプルレート**: 8000, 16000, 22050, 44100, 48000 Hz（推奨: 44100以下）
- **チャンネル数**: 1（モノラル）、2（ステレオ）
- **録音時間**: 1〜60秒
- **音声ゲイン**: 1.0x〜5.0x

### Whisper設定
- **モデルサイズ**: tiny, base, small, medium, large
- **言語**: ja（日本語）, en（英語）, auto（自動）
- **温度**: 0.0（決定論的）〜1.0（ランダム）
- **高精度パラメータ**: 圧縮比閾値、対数確率閾値、無音閾値

### ショートカット設定
- **有効/無効**: ショートカットキーの使用を制御
- **グローバルホットキー**: アプリがフォーカスされていない時も有効
- **カスタムキー**: 各機能のショートカットキーを変更

### トラブルシューティング設定
- **リトライ回数**: 1〜10回（推奨: 3回以上）
- **タイムアウト**: 5〜30秒
- **エラー回復**: 有効/無効
- **エラーログ**: 有効/無効

## 📦 依存関係

### 主要パッケージ
- `streamlit>=1.28.0`: Webアプリケーションフレームワーク
- `whisper-openai>=20231117`: 音声認識
- `pyaudio>=0.2.11`: 音声録音
- `numpy>=1.21.0`: 数値計算
- `scipy>=1.7.0`: 科学計算
- `librosa>=0.9.0`: 音声処理
- `SpeechRecognition>=3.10.0`: 音声認識機能
- `whisper>=1.1.10`: 高精度音声認識

### LLM関連（オプション）
- `openai>=1.0.0`: OpenAI API
- `anthropic>=0.7.0`: Anthropic API
- `google-generativeai>=0.3.0`: Google Generative AI

## 🔍 トラブルシューティング

### よくある問題と解決方法

#### Errno -9999 ホストエラー
**原因**: 他のアプリがマイクを使用中、権限不足
**解決方法**:
1. 他のアプリ（ブラウザ、Zoom、Teams等）を終了
2. Windows設定 → プライバシーとセキュリティ → マイクでアクセス許可
3. デバイスドライバーを更新
4. 仮想オーディオデバイスを一時的に無効化
5. アプリを管理者として実行
6. チャンクサイズを大きくする（2048, 4096）
7. サンプルレートを下げる（22050, 16000）

#### 音声レベルが低い
**解決方法**:
1. ゲイン設定を上げる
2. マイクに近づく
3. Windows設定でマイク音量を確認
4. マイクブーストを有効にする

#### デバイスが認識されない
**解決方法**:
1. デバイスマネージャーでマイクが有効か確認
2. デバイスドライバーを再インストール
3. デバイスを再接続
4. アプリを再起動

#### 文字起こしが空になる
**解決方法**:
1. 音声レベルを確認
2. より明確に話す
3. 静かな環境で録音
4. 高精度設定を使用

#### ショートカットが動作しない
**解決方法**:
1. 設定ページでショートカットが有効になっているか確認
2. キーの設定が正しいか確認
3. ブラウザの制限を確認（F1キー等）
4. 他のアプリケーションとのキー競合を確認

## 🎯 精度向上のポイント

### 音声品質
- **静かな環境**: 背景ノイズを最小限に
- **クリアな発音**: はっきりと話す
- **適切な距離**: マイクから20-30cm程度
- **音声レベル**: RMS 100以上を目標

### 設定最適化
- **チャンクサイズ**: 1024以上で安定性向上
- **サンプルレート**: 44100Hz以下で互換性向上
- **ゲイン**: 音声レベルに応じて調整（1.5x〜3.0x推奨）
- **モデルサイズ**: 精度と速度のバランス（base推奨）

### 高精度設定
- **ノイズ除去**: 自動でノイズを除去
- **音量正規化**: 音声レベルを最適化
- **初期プロンプト**: 言語や内容のヒントを提供
- **複数モデル比較**: 最適な結果を選択

## 📝 更新履歴

### v3.0.0 (完全統合版)
- ✅ ショートカットキー機能の追加
- ✅ 音声修正機能の統合
- ✅ ユーザー辞書機能の統合
- ✅ コマンド管理機能の統合
- ✅ 設定ページの拡張（ショートカット設定タブ追加）
- ✅ 視覚的フィードバック機能
- ✅ カスタマイズ可能なキー設定

### v2.0.0 (設定機能付き統合版)
- ✅ 設定ページの追加
- ✅ エラーハンドリング機能の強化
- ✅ システム診断機能の追加
- ✅ 設定の保存・読み込み機能
- ✅ 設定のエクスポート・インポート機能
- ✅ 詳細なトラブルシューティング情報
- ✅ 推奨設定の自動提案

### v1.0.0 (基本版)
- ✅ マイクデバイス選択機能
- ✅ 音声ゲイン機能
- ✅ レベル監視機能
- ✅ 高精度文字起こし
- ✅ 複数モデル比較
- ✅ ファイル管理機能

## 🔮 今後の拡張予定

### LLM統合
- **OpenAI GPT-4**: 高度な要約・分析
- **Anthropic Claude**: 構造化された出力
- **Google Gemini**: マルチモーダル処理

### 音声コマンド拡張
- **カスタムコマンド**: ユーザー定義コマンド
- **音声ショートカット**: 頻繁に使用するコマンドの登録
- **音声プロファイル**: 個人別の音声認識設定

### 辞書機能拡張
- **自動学習**: 使用頻度に基づく自動分類
- **クラウド同期**: 複数デバイス間での同期
- **共有辞書**: チーム間での辞書共有

### ショートカット機能拡張
- **マクロ機能**: 複数のショートカットを組み合わせたマクロ
- **プロファイル機能**: 用途別のショートカット設定
- **音声ショートカット**: 音声コマンドでショートカット実行
- **外部連携**: 他のアプリケーションとの連携

## 🤝 貢献

バグ報告や機能要望は、GitHubのIssuesでお知らせください。

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

---

**注意事項:**
- 初回起動時はWhisperモデルのダウンロードに時間がかかります
- 高精度設定は処理時間が長くなります
- マイクへのアクセス許可が必要です
- Windows環境での動作を最適化しています
- ショートカットキーはブラウザの制限により、一部の組み合わせが利用できない場合があります
- グローバルホットキーは一部のブラウザで動作しない場合があります
