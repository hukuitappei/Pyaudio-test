# Google Cloud Console設定詳細ガイド

## プロジェクト情報
- **プロジェクトID**: `voice-memo-app-467900`
- **プロジェクトURL**: https://console.cloud.google.com/auth/branding?project=voice-memo-app-467900

## 設定手順

### ステップ1: Google Cloud Consoleにアクセス
1. [Google Cloud Console](https://console.cloud.google.com/auth/branding?project=voice-memo-app-467900) にアクセス
2. プロジェクト `voice-memo-app-467900` が選択されていることを確認

### ステップ2: APIとサービスに移動
1. 左側のメニューから「**APIとサービス**」をクリック
2. 「**認証情報**」をクリック

### ステップ3: OAuth 2.0クライアントIDの確認・作成

#### 既存のクライアントIDがある場合
1. 「**OAuth 2.0クライアントID**」セクションを探す
2. 既存のクライアントIDをクリック

#### 新規作成が必要な場合
1. 「**+ 認証情報を作成**」をクリック
2. 「**OAuth クライアントID**」を選択
3. アプリケーションの種類で「**デスクトップアプリケーション**」を選択
4. 名前を入力（例：「Streamlit App」）
5. 「**作成**」をクリック

### ステップ4: リダイレクトURIの設定
「**承認済みのリダイレクトURI**」セクションで：

#### 削除するURI（もしあれば）
```
https://pyaudio-test-8fnqhyhtvx8vlgz2mzkocy.streamlit.app/
```

#### 追加するURI
```
urn:ietf:wg:oauth:2.0:oob
```

### ステップ5: 設定を保存
「**保存**」ボタンをクリック

## トラブルシューティング

### 問題1: OAuth 2.0クライアントIDが見つからない
**原因**: まだ作成されていない
**解決方法**:
1. 「**+ 認証情報を作成**」をクリック
2. 「**OAuth クライアントID**」を選択
3. アプリケーションの種類で「**デスクトップアプリケーション**」を選択
4. 名前を入力
5. 「**作成**」をクリック

### 問題2: リダイレクトURIが追加できない
**原因**: 既存のURIが競合している
**解決方法**:
1. 既存のURIをすべて削除
2. `urn:ietf:wg:oauth:2.0:oob` を追加
3. 「**保存**」をクリック

### 問題3: 保存できない
**原因**: ブラウザのキャッシュまたは権限の問題
**解決方法**:
1. ブラウザのキャッシュをクリア
2. ページを再読み込み
3. 再度設定を試行
4. 別のブラウザで試行

### 問題4: 権限エラー
**原因**: プロジェクトの編集権限がない
**解決方法**:
1. プロジェクトの所有者または編集者権限を確認
2. 必要に応じて権限を要求

## 設定確認チェックリスト

### 必須項目
- [ ] プロジェクトID: `voice-memo-app-467900`
- [ ] OAuth 2.0クライアントIDが存在する
- [ ] リダイレクトURI: `urn:ietf:wg:oauth:2.0:oob`
- [ ] 設定が保存されている

### 推奨項目
- [ ] Google Calendar APIが有効化されている
- [ ] クライアントIDとクライアントシークレットをメモ
- [ ] 認証情報のバックアップ

## APIの有効化確認

### Google Calendar APIの有効化
1. 「**APIとサービス**」→「**ライブラリ**」をクリック
2. 「**Google Calendar API**」を検索
3. 「**有効にする**」をクリック

### その他の必要なAPI
- Google Calendar API
- Google OAuth2 API

## 設定完了後の手順

### 1. アプリケーションでの認証
1. アプリケーションに戻る
2. 「🔄 認証フローをリセット」をクリック
3. 「🔄 ページを再読み込み」をクリック
4. 「🔑 Google認証を開始」をクリック
5. 「方法2: Streamlit Cloud用認証フロー」を選択

### 2. 認証手順
1. 認証URLをクリック
2. Google認証画面でアプリケーションを承認
3. 認証コードをコピー
4. アプリケーションの入力欄に貼り付け
5. 「認証を完了」をクリック

### 3. リフレッシュトークンの設定
1. 認証完了後、新しいリフレッシュトークンが表示される
2. Streamlit Cloud Secretsに設定
3. 接続テストを実行

## 重要な注意事項

1. **プロジェクトの選択**: 正しいプロジェクト `voice-memo-app-467900` が選択されていることを確認
2. **URIの正確性**: `urn:ietf:wg:oauth:2.0:oob` を正確に入力
3. **設定の保存**: 必ず「保存」ボタンをクリック
4. **権限の確認**: プロジェクトの編集権限があることを確認

## 関連ファイル
- `.streamlit/secrets.toml`: 認証情報設定
- `src/utils_audiorec.py`: 認証管理機能

## 更新日時
2025年1月現在
