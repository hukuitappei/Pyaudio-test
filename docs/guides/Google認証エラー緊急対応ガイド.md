# Google認証エラー緊急対応ガイド

## エラー内容
```
接続テストに失敗: ('invalid_grant: Bad Request', {'error': 'invalid_grant', 'error_description': 'Bad Request'})
```

## 原因
- Google認証のリフレッシュトークンが無効化されている
- 認証情報の設定に問題がある
- Google Cloud Consoleでの設定が変更されている

## 緊急対応手順

### ステップ1: 認証状態の完全リセット
1. アプリケーションのカレンダー管理タブに移動
2. 「🔄 認証フローをリセット」ボタンをクリック
3. 「🔄 ページを再読み込み」ボタンをクリック

### ステップ2: 認証情報の確認
Streamlit Secretsで以下の設定を確認：

```toml
# .streamlit/secrets.toml
GOOGLE_CLIENT_ID = "your-client-id"
GOOGLE_CLIENT_SECRET = "your-client-secret"
GOOGLE_REFRESH_TOKEN = "your-refresh-token"
```

### ステップ3: 新しい認証の実行
1. カレンダー管理タブで「🔑 Google認証を開始」をクリック
2. 表示された認証URLをクリック
3. Google認証画面でアプリケーションを承認
4. 認証コードをコピーしてアプリケーションに貼り付け

### ステップ4: 接続テストの実行
認証完了後、「🔍 接続テスト」を実行して正常に接続できることを確認

## トラブルシューティング

### 問題1: 認証URLが表示されない
**解決方法:**
- ページを再読み込み
- ブラウザのキャッシュをクリア
- 別のブラウザで試行

### 問題2: 認証コードが無効
**解決方法:**
- 認証コードを再取得
- 認証URLを再生成
- 認証フローを完全にリセット

### 問題3: 接続テストが継続して失敗
**解決方法:**
- Google Cloud ConsoleでOAuth 2.0クライアントIDを確認
- リダイレクトURIの設定を確認
- APIの有効化状況を確認

## 予防策

### 定期的な認証状態確認
- 週1回程度、カレンダー同期機能をテスト
- 認証エラーが発生した場合は早期に対応

### 認証情報のバックアップ
- 有効な認証情報を安全な場所に保存
- 認証情報の変更時は即座に更新

## 連絡先
問題が解決しない場合は、以下の情報と共にサポートに連絡してください：

1. エラーメッセージの詳細
2. 実行した手順
3. ブラウザとOSの情報
4. 認証情報の設定状況（機密情報は除く）

## 更新日時
2025年1月現在
