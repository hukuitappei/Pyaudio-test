# セットアップガイド

## 🔐 安全なAPIキー管理

このアプリケーションでは、OpenAI APIキーを安全に管理するために`st.secrets`を使用しています。

## 📁 設定ファイル

### .streamlit/secrets.toml
```toml
[openai]
api_key = "your-actual-openai-api-key-here"
```

## 🚀 セットアップ手順

### 1. ローカル開発環境

1. **secrets.tomlファイルを作成**
   ```bash
   mkdir -p .streamlit
   ```

2. **APIキーを設定**
   ```bash
   # .streamlit/secrets.tomlファイルを作成
   echo '[openai]' > .streamlit/secrets.toml
   echo 'api_key = "your-actual-openai-api-key-here"' >> .streamlit/secrets.toml
   ```

3. **実際のAPIキーに置き換え**
   - `your-actual-openai-api-key-here`を実際のOpenAI APIキーに置き換え
   - APIキーは`sk-`で始まる文字列

### 2. Streamlit Cloud環境

1. **Streamlit Cloudダッシュボードにアクセス**
2. **アプリケーションの設定**を開く
3. **Secrets**タブを選択
4. **以下の形式でAPIキーを追加**:
   ```toml
   [openai]
   api_key = "your-actual-openai-api-key-here"
   ```

## 🔒 セキュリティの利点

### ✅ st.secretsの利点
- **Git除外**: `.gitignore`で自動的に除外される
- **環境別管理**: 開発・本番環境で異なるキーを使用可能
- **Streamlit Cloud対応**: クラウド環境での安全な管理
- **暗号化**: Streamlit Cloudでは暗号化して保存

### ❌ 従来の.envファイルの問題
- **誤コミット**: うっかりGitにコミットしてしまうリスク
- **環境依存**: ローカル環境でのみ動作
- **管理複雑**: 複数環境での管理が困難

## 🛠️ コード例

### 安全なAPIキー読み込み
```python
import streamlit as st
import openai

# secrets.tomlファイルからAPIキーを取得
try:
    api_key = st.secrets["openai"]["api_key"]
    if api_key and api_key != "your-openai-api-key-here":
        openai_client = openai.OpenAI(api_key=api_key)
    else:
        st.warning("⚠️ OpenAI APIキーが設定されていません")
except Exception as e:
    st.error(f"❌ APIキーの読み込みに失敗: {str(e)}")
```

## 🔍 トラブルシューティング

### よくある問題

#### 1. APIキーが見つからない
```
KeyError: 'openai'
```
**解決策**: `.streamlit/secrets.toml`ファイルが正しい場所にあるか確認

#### 2. APIキーが無効
```
Error code: 401 - Invalid API key
```
**解決策**: APIキーが正しく設定されているか確認

#### 3. ファイルが見つからない
```
FileNotFoundError: .streamlit/secrets.toml
```
**解決策**: `.streamlit`ディレクトリと`secrets.toml`ファイルを作成

## 📋 チェックリスト

### ローカル環境
- [ ] `.streamlit/secrets.toml`ファイルが存在
- [ ] APIキーが正しく設定されている
- [ ] APIキーが`sk-`で始まっている
- [ ] `.gitignore`で`secrets.toml`が除外されている

### Streamlit Cloud環境
- [ ] Streamlit CloudでSecretsが設定されている
- [ ] APIキーが正しい形式で入力されている
- [ ] アプリケーションが正常に起動する

## 🚨 重要な注意事項

1. **絶対にGitにコミットしない**
   - APIキーは機密情報です
   - 誤ってコミットした場合は即座にキーを再生成

2. **APIキーの共有禁止**
   - チームメンバーには個別にキーを発行
   - 共有キーは使用しない

3. **定期的なキーローテーション**
   - セキュリティのため定期的にキーを更新
   - 古いキーは削除

## 📞 サポート

問題が発生した場合は、以下を確認してください：
1. APIキーの形式が正しいか
2. `.streamlit/secrets.toml`ファイルの場所
3. Streamlit CloudのSecrets設定
4. ネットワーク接続状況 